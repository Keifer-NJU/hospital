# 采购订单管理系统
## 需求概述
目标：将原来人工操作的数据上传能力系统化，通过程序，批量、准确、全口径向医保药械平台上传我院挂网范畴内医用耗材及试剂采购订单、实现价格联动、上线结算
必要性：
1. 我院末全部在医保药械平台上传订单及后续工作，2024年中央审计署发现该问题，要求我院分阶段整改，每季度向医保局汇报整改完成情况;
2. 我院现有医用耗材及试剂采购量大，医保药械平台操作繁琐，若人工上传订单，每天约上传800-1200条数据，涉及环节4项，预计每天需占用一人八小时工作时间，旦人工核对易产生疏漏;了、原尝试通过hrp与医保药械平台接口对接，实现自动上传，但目前医保药械平台接口关闭，经反馈医保局，明确反馈我院暂不考虑接口对接方案，考虑人工或其他非接口对接方式完成上传及后续工作

## 整体功能
- 登录模块：用户登录系统，进行身份验证，确保只有授权用户才能访问系统功能。
- 采购订单填报管理
    - 采购订单查询:与HRP系统相连，通过 API 接口查询的方式，查询HRP系统中入库单数据，提供筛选功能，查询的数据返回给前端，前端渲染成表格。
        - 表格功能：支持查看详情、数据选择后可批量填报医保平台
        - 表格内容：
    - 填报任务管理：整体为填报任务管理，每个批量填报后都会生成一个任务，“填报任务管理”即历史所有的任务管理，首先是任务列表，点击某个任务进入任务详情页面，查看任务进度和状态等，每个任务详情内容包括整体进度和状态，以及每个任务下数据列表的进度和状态等，这个数据列表参考目前“数据上传”模块的表格内容；
        - 任务下上报数据列表内容：入库单号、产品Id、
- 系统管理
- 帮助中心

## 功能模块详细描述
- ### 登录模块
    - 功能描述：用户通过输入用户名和密码进行登录，系统验证用户身份，确保只有授权用户才能访问系统功能。
    - 主要功能点：
        - 用户名和密码输入框。 内置一个默认账号- 账号：18916836260，密码：mXDK52un
        - 登录按钮
        - 忘记密码功能
        - 登录状态提示（成功或失败）
- ### 数据上传模块
    - 功能描述：与HRP系统相连，通过 API 接口查询的方式，查询HRP系统中入库单数据，提供筛选功能(具体条件看“功能点详细描述”)，查询的数据返回给前端，前端渲染成表格，表格具体内容见“功能点详细描述”。
    - 功能点详细描述：
        - 数据查询：提供查询条件：入库单号、物资名称、规格型号、品牌、审核状态、时间范围。
        - 数据展示：将查询到的入库单数据以表格形式展示：入库单号、物资名称、规格型号、品牌、审核状态、供货单位、采购数量、计划价格，支持分页显示。
        - 数据导出：支持将查询结果导出为 Excel 或 CSV 格式文件。
        - 批量填报功能：提供批量填报按钮，用户可以选择需要上传的入库单数据进行填报，每次批量填报都生成一个任务，点击批量填报后进入该任务的详情页面。 任务分为两步，数据校验和数据填报，校验完成才能到下一步填报，填报可回退到上一步。
        - 任务详情：展示每个任务的状态和实时进度，以及每个任务下填报数据列表的一些信息。这个页面即“填报任务管理”中的任务详情页面
            - 任务下数据内容在入库单数据基础上加产品Id、校验状态、上传状态、结算类型、类型、上传失败原因、上传时间、价格是否修改、产品价格、省最高参考价等。

- ### 填报任务管理
    - 功能描述：整体为填报任务管理，每个批量上传后都会生成一个任务，“填报任务管理”即历史所有的任务管理，首先是任务列表，点击某个任务进入任务详情页面，查看任务进度和状态等；
    - 功能点详细描述：
        - 任务列表：查看任务列表，包含任务ID、创建时间、状态等信息。
        - 任务详情：点击某个任务进入任务详情页面，查看任务进度和状态等。每个任务详情内容包括数据校验、数据填报两个流程，步骤和功能要求是，首先是数据校验，校验完成才能进入填报流程，填报流程可回退上一步，整体在页面上方显示整体流程和正在处理的流程。
          - 然后数据校验和数据填报时，整体的页面布局基本一致，流程栏下是数据量统计模块，显示总量、成功、失败、正在处理的数据量，根据任务进度实时更新。
          - 再统计模块下面是数据校验任务或者填报任务的进度条，实时更新直到完成。最后是一个数据表格，显示数据校验或者数据填报的具体数据，这个数据表格在数据校验和数据填报时有些许不同，首先都是有订单的基础信息，其次数据校验额外添加校验状态和失败原因、数据填报则是添加填报状态和失败原因。
          - 任务进度的实时更新采用后端通知，websocket的方式，不要采取前端轮询。
           - 进度条和设计原则用户感知优先
           避免 “空白等待”：任务启动后立即显示进度条，哪怕初始为「0%」，也需搭配 “任务初始化中...” 文案，明确告知 “系统已响应”；
           拒绝 “进度跳变”：拆分批量任务为「总进度 + 子任务进度」，避免单条进度从 10% 直接跳至 50%，用细粒度反馈降低 “失控感”；
           关联 “具体信息”：进度条需绑定 “当前处理对象”（如 “正在上传第 3/20 条入库单：No.20240819001”），让进度与实际业务动作挂钩，而非单纯数字变化。
           - 任务详情页面可以返回到任务管理页面


## 前端交互需要易用、美观、高级、响应式
- 页面整体风格简洁大方，采用现代化设计风格，颜色搭配高级美观，各个页面风格和组件样式等统一。

## 用户操作
- 用户登录后，进入系统首页，左侧菜单栏显示各功能模块
- 采购订单查询模块，查看订单信息后，批量选择后点击批量填报，调用后端接口上报数据；
- 点击批量填报后背后会生成一个任务，同时进入该任务的详情页面，先进行数据校验，校验完成再到数据填报，每个步骤展示任务进度和状态等；
- 也可以进入”填报任务管理“模块，查看所有任务，点击某个任务进入任务详情页面，查看任务进度和状态等；

## 数据模型
- 入库单数据模型
```sql
CREATE TABLE IF NOT EXISTS purchase_order (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_no VARCHAR(50) NOT NULL COMMENT '入库单号',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    audit_status VARCHAR(20) DEFAULT 'PENDING' COMMENT '审核状态 PENDING-待审核 APPROVED-已审核 REJECTED-已驳回',
    upload_status VARCHAR(20) DEFAULT 'PENDING' COMMENT '上传状态 PENDING-待上传 SUCCESS-上传成功 FAILED-上传失败',
    total_amount DECIMAL(12,2) COMMENT '总金额',
    remark TEXT COMMENT '备注',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
);
```
- 上传结果记录
    - 入库单号
    - 产品id
    - 上传状态， 1-成功， 2-失败
    - 结算类型， 1-耗材交易结算， 2-试剂交易结算
    - 类型，1-挂网产品，2-带量专区
    - 上传失败原因, 1-医保平台搜不到该产品或者搜不到公司;2-搜到产品，但是产品的物资名称、规格型号、品牌等不一致
    - 上传时间
    - 价格是否修改
    - 产品价格
    - 省最高参考价

## 任务进度管理
一、核心设计原则：用户感知优先
避免 “空白等待”：任务启动后立即显示进度条，哪怕初始为「0%」，也需搭配 “任务初始化中...” 文案，明确告知 “系统已响应”；
拒绝 “进度跳变”：拆分批量任务为「总进度 + 子任务进度」，避免单条进度从 10% 直接跳至 50%，用细粒度反馈降低 “失控感”；
关联 “具体信息”：进度条需绑定 “当前处理对象”（如 “正在上传第 3/20 条入库单：No.20240819001”），让进度与实际业务动作挂钩，而非单纯数字变化。


## 技术选
- 采取前后端分离的架构和包结构
- 前端技术：使用 Vue.js 框架进行开发，提供响应式界面和良好的用户体验。
- 后端技术：使用Java Spring Boot 框架进行开发。
- 数据库：使用 MySQL 数据库存储入库单数据和日志信息。可以先使用H2自带数据库进行开发，后期部署时切换为MySQL
- 持久层框架：使用 MyBatis 进行数据访问和操作。
- 部署环境：使用 Docker 容器化部署，确保系统的可移植性和易维护性。
- 负载均衡：如果系统需要支持高并发访问，可以考虑使用 Nginx 进行负载均衡和反向代理。